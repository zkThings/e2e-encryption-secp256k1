<!DOCTYPE html>
<html>
<head>
    <title>Encryption Test</title>
    <script type="module">
        import * as secp from "https://cdn.jsdelivr.net/npm/@noble/secp256k1@2.2.3/+esm";
        window.secp256k1 = secp;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script type="module">
        import { ETHEncryption } from './src/encryption/ethEncryption.browser.js';
        
        window.runTest = async () => {
            const encryption = new ETHEncryption();
            
            // Test data
            const testMessage = "Hello, World!";
            const testAddress = "0x" + "1".repeat(40);
            const wrongPrivateKey = "0x" + "2".repeat(64);
            
            // Run test with correct key
            console.log('\n=== TEST 1: Using Correct Private Key ===');
            try {
                await encryption.getPublicKey(testAddress);
                const correctPrivateKey = encryption.testWallet.privateKey;
                
                console.log('Encrypting:', testMessage);
                const encrypted = await encryption.encryptFor(testMessage, testAddress);
                console.log('Encrypted data:', encrypted);
                
                const decrypted = await encryption.decrypt({
                    publicSignals: encrypted.publicSignals,
                    privateKey: correctPrivateKey
                });
                console.log('Successfully decrypted:', decrypted);
            } catch (error) {
                console.error('Test 1 failed:', error);
            }
            
            // Run test with wrong key
            console.log('\n=== TEST 2: Using Wrong Private Key ===');
            try {
                await encryption.getPublicKey(testAddress);
                
                console.log('Encrypting:', testMessage);
                const encrypted = await encryption.encryptFor(testMessage, testAddress);
                console.log('Encrypted data:', encrypted);
                
                const decrypted = await encryption.decrypt({
                    publicSignals: encrypted.publicSignals,
                    privateKey: wrongPrivateKey
                });
                console.log('Decrypted (should not happen):', decrypted);
            } catch (error) {
                console.error('Test 2 failed (expected):', error);
            }
            
            document.getElementById('results').textContent = 'Tests completed. Check console for details.';
        };
    </script>
</head>
<body>
    <h1>Encryption Test</h1>
    <button onclick="runTest()">Run Test</button>
    <pre id="results"></pre>
</body>
</html>